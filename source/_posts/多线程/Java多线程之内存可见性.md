**可见性**：一个线程对共享变量值的修改，能够及时地被其他线程看到。

**共享变量**：如果一个变量在多个线程的工作内存中都存在副本，那么这个变量就是这几个线程的共享变量。

**Java内存模型（JMM）**
+ 所有的变量都存储在主内存中
+ 每个线程都有自己独立的工作内存，里面保存该线程使用到的变量的副本（主内存中该变量的一份拷贝）

**两条规定**
+ 线程对共享变量的所有操作都必须在自己的工作内存中进行，不能直接从主内存中读写
+ 不同线程之间无法直接访问其他线程工作内存中的变量，线程间变量值的传递需要通过主内存来完成

---
要实现共享变量的可见性，必须保证两点：
+ 线程修改后的共享变量值能够及时从工作内存刷新到主内存中
+ 其他线程能够及时把共享变量的最新值从主内存更新到自己的工作内存中

---
Java语言层面支持的可见性实现方式：
+ synchronized
+ volatile

synchronized能够实现：
+ 原子性
+ 可见性

JMM关于synchronized的两条规定：
+ 线程解锁前，必须把共享变量的最新值刷新到主内存中
+ 线程加锁时，将清空工作内存中共享变量的值，从而使用共享变量时需要从主内存中重新读取最新的值（注意：加锁与解锁需要是同一把锁）

线程解锁前对共享变量的修改在下次加锁时对其他线程可见

---
线程执行互斥代码的过程：
1. 获得互斥锁
2. 清空工作内存
3. 从主内存拷贝变量的最新副本到工作内存
4. 执行代码
5. 将更改后的共享变量的值刷新到主内存
6. 释放互斥锁
