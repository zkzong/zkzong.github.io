---
title: Redis基础篇
date: 2020-12-02
categories: Redis
---

**关系型数据库的特点： **
1、它以表格的形式，基于行存储数据，是一个二维的模式。
2、它存储的是结构化的数据，数据存储有固定的模式（schema），数据需要适应表结构。
3、表与表之间存在关联（Relationship）。 
4、大部分关系型数据库都支持 SQL（结构化查询语言）的操作，支持复杂的关联查询。
5、通过支持事务（ACID 酸）来提供严格或者实时的数据一致性。

**但是使用关系型数据库也存在一些限制，比如：**
1、要实现扩容的话，只能向上（垂直）扩展，比如磁盘限制了数据的存储，就要扩 大磁盘容量，通过堆硬件的方式，不支持动态的扩缩容。水平扩容需要复杂的技术来实 现，比如分库分表。 
2、表结构修改困难，因此存储的数据格式也受到限制。 
3、在高并发和高数据量的情况下，我们的关系型数据库通常会把数据持久化到磁盘， 基于磁盘的读写压力比较大。

**非关系型数据库的特点： **
1、存储非结构化的数据，比如文本、图片、音频、视频。
2、表与表之间没有关联，可扩展性强。
3、保证数据的最终一致性。遵循 BASE（碱）理论。 Basically Available（基本 可用）； Soft-state（软状态）； Eventually Consistent（最终一致性）。 
4、支持海量数据的存储和高并发的高效读写。
5、支持分布式，能够对数据进行分片存储，扩缩容简单。

对于不同的存储类型，我们又有各种各样的非关系型数据库，比如有几种常见的类型： 
1、KV 存储，用 Key Value 的形式来存储数据。比较常见的有 Redis 和 MemcacheDB。
2、文档存储，MongoDB。 
3、列存储，HBase。 
4、图存储，这个图（Graph）是数据结构，不是文件格式。Neo4j。 
5、对象存储。 
6、XML 存储等等等等。

**Redis 的特性： **
1）更丰富的数据类型 
2）进程内与跨进程；单机与分布式 
3）功能丰富：持久化机制、过期策略 
4）支持多种编程语言 
5）高可用，集群

默认有 16 个库（0-15），可以在配置文件中修改，默认使用第一个 db0。
因为没有完全隔离，不像数据库的 database，不适合把不同的库分配给不同的业务使用。

Redis 是字典结构的存储方式，采用 key-value 存储。key 和 value 的最大长度限制 是 512M。

# 数据类型
**Redis 一共有几种数据类型？**（注意是数据类型不是数据结构）
String、Hash、Set、List、Zset、Hyperloglog、Geo、Streams

## String 字符串
可以用来存储字符串、整数、浮点数。

**存储（实现）原理**
以set hello word 为例，因为 Redis 是 KV 的数据库，它是通过 hashtable 实现的（我 们把这个叫做外层的哈希）。所以每个键值对都会有一个 dictEntry（源码位置：dict.h）， 里面指向了 key 和 value 的指针。next 指向下一个 dictEntry。
key 是字符串，但是 Redis 没有直接使用 C 的字符数组，而是存储在自定义的 SDS 中。
value 既不是直接作为字符串存储，也不是直接存储在 SDS 中，而是存储在 redisObject 中。实际上五种常用的数据类型的任何一种，都是通过 redisObject 来存储 的。

**字符串类型的内部编码有三种：**
1、int，存储 8 个字节的长整型（long，2^63-1）。 
2、embstr， 代表 embstr 格式的 SDS（Simple Dynamic String 简单动态字符串）， 存储小于 44 个字节的字符串。 
3、raw，存储大于 44 个字节的字符串（3.2 版本之前是 39 字节）。

**应用场景**
缓存、数据共享分布式、分布式锁、全局 ID、计数器、限流、位统计

## Hash 哈希
包含键值对的无序散列表。**value 只能是字符串**，不能嵌套其他类型。

同样是存储字符串，Hash 与 String 的主要区别？ 
1、把所有相关的值聚集到一个 key 中，节省内存空间 
2、只使用一个 key，减少 key 冲突 
3、当需要批量获取值的时候，只需要使用一个命令，减少内存/IO/CPU 的消耗

Hash 不适合的场景： 
1、Field 不能单独设置过期时间 
2、没有 bit 操作 
3、需要考虑数据量分布的问题（value 值非常大的时候，无法分布到多个节点）